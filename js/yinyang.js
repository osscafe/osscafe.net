// Generated by CoffeeScript 1.3.1
var YinYang,cbSplit,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);d.prototype=b.prototype;a.prototype=new d;a.__super__=b.prototype;return a};YinYang=function(){function a(){this.build=__bind(this.build,this);this.setup()}a.version="0.2.4";a.plugins={};a.filters={};a.templates={};a.createFilter=function(b){var c,d,e;d=b.split(":");e=d.shift();d=function(){var a,b,e;e=[];for(a=0,b=d.length;a<b;a++){c=d[a];c.match(/^[1-9][0-9]*$/)?e.push(Number(c)):e.push(c.replace(/^\s*('|")|("|')\s*$/g,""))}return e}();return a.filters[e]!=null?new a.filters[e](d):new a.filter(d)};a.getTemplate=function(b){return a.templates[b]!=null?a.templates[b]:null};a.createTemplate=function(b,c){var d;d=b.replace(/[^\/]+$/,"");c=c.replace(/(href|src)="((?![a-z]+:\/\/|\.\/|\/|\#).*?)"/g,function(){return""+arguments[1]+'="'+d+arguments[2]+'" '});return this.templates[b]=new a.Template(c)};a.guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;b=Math.random()*16|0;c=a==="x"?b:b&3|8;return c.toString(16)}).toUpperCase()};a.prototype.template=null;a.prototype.document_meta={};a.prototype.selfload=!1;a.prototype.setup=function(){var a,b,c,d,e,f;e=$("meta");f=[];for(c=0,d=e.length;c<d;c++){a=e[c];if($(a).attr("content")==null)continue;b=$(a).attr("name")||$(a).attr("property");if(b==="yinyang:selfload"&&$(a).attr("content")==="true")f.push(this.selfload=!0);else{b=b.replace(/[^a-zA-Z0-9_]/g,"_");f.push(this.document_meta[b]=$(a).attr("content"))}}return f};a.prototype.fetch=function(a){var b,c=this;if(this.selfload){b=$("html").html();b=b.replace(/#%7B(.*?)%7D/gm,"#{$1}");b=b.replace(/<script.*?>.*?<\/script>/gim,"");this.redrawAll(this.build(location.href,b))}if(a)return $.ajax({url:a,success:function(b){return c.redrawAll(c.build(a,b))}})};a.prototype.build=function(b,c){this.template=a.createTemplate(b,c);return this.template.display(this)};a.prototype.redrawAll=function(a){var b,c,d,e,f;$("body").html(a.split(/<body.*?>|<\/body>/ig)[1]);$("head>*").not("script").remove();$("head").prepend(a.split(/<head.*?>|<\/head>/ig)[1]);e=$(a.match(/<body.*?>/i)[0].replace(/^\<body/i,"<div"))[0].attributes;f=[];for(c=0,d=e.length;c<d;c++){b=e[c];b.name==="class"?f.push($("body").addClass(b.value)):b.value&&b.value!=="null"?f.push($("body").attr(b.name,b.value)):f.push(void 0)}return f};return a}();YinYang.filter=function(){function a(a){this.args=a}a.prototype._process=function(a){switch(this.args.length){case 0:return this.process(a);case 1:return this.process(a,this.args[0]);case 2:return this.process(a,this.args[0],this.args[1]);default:return this.process(a,this.args[0],this.args[1],this.args[2])}};a.prototype.process=function(a){return a};return a}();YinYang.plugin=function(){function a(a,b,c){this.template=a;this.var_name=b;this.arg=c;this.process()}a.prototype.process=function(){return this.setValue(this.arg)};a.prototype.setValue=function(a){this.template.setValue(this.var_name,a);return this.template.processPlaceholder(this.var_name)};return a}();$("head").append("<style>body {background:#FFF} body * {display:none}</style>");$(function(){var a,b;a=$("link[rel=template]").attr("href");b=new YinYang;return b.fetch(a)});YinYang.Template=function(){function a(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;h=function(){var a,b;a=YinYang.plugins;b=[];for(e in a){f=a[e];b.push(e)}return b}().join("|");o=a.match(new RegExp('<meta.*? name="('+h+')\\.[a-z][a-zA-Z0-9_\\.]+".*?>',"gim"))||[];for(k=0,m=o.length;k<m;k++){d=o[k];j=$(d).attr("name");g=j.split(".")[0];b=$(d).attr("content");this.datasource[j]=new YinYang.plugins[g](this,j,b)}i=this.root=new YinYang.TemplateRoot(this);p=a.split(/(<!--\{.+?\}-->|\#\{.+?\})/gim);for(l=0,n=p.length;l<n;l++){c=p[l];c!=null&&(i=i.add(c))}}a.prototype.values={meta:{},ajax:{},hsql:{}};a.prototype.placeholders={};a.prototype.datasource={};a.prototype.root=null;a.prototype.display=function(a){this.values.meta=a.document_meta;return this.root.display()};a.prototype.valueExists=function(a){var b,c,d,e;c=a.split(".");d=this.values;while(d!=null&&(b=c.shift()))d=(e=d[b])!=null?e:null;return d!=null};a.prototype.setValue=function(a,b){var c,d,e,f,g;d=a.split(".");e=d.pop();f=this.values;while(c=d.shift())f=(g=f[c])!=null?g:"";return f[e]=b};a.prototype.setValues=function(a){var b,c,d;d=[];for(b in a){if(!__hasProp.call(a,b))continue;c=a[b];d.push(this.values[b]=c)}return d};a.prototype.getValue=function(a){var b,c,d,e;c=a.split(".");d=this.values;while(b=c.shift())d=(e=d[b])!=null?e:"";return d};a.prototype.addPlaceholder=function(a,b,c){return this.placeholders[a]={name:b,callback:c}};a.prototype.processPlaceholder=function(a){var b,c,d;d=this.placeholders;for(c in d){b=d[c];if(b.name.indexOf(a)!==0)continue;b.callback();delete this.placeholders[c]}return!0};return a}();YinYang.TemplateRoot=function(){function a(a,b,c,d){this.template=a;this.parent=b!=null?b:null;this.value=c!=null?c:"";this.ignore=d!=null?d:!1;this.children=[]}a.prototype.add=function(a){var b;b={pend:/<!--\{end\}-->/,more:/<!--\{more\}-->/,pvar:/<!--\{(@[a-zA-Z0-9_\.\#>=\[\]]+|[a-zA-Z][a-zA-Z0-9_\.]*)(\|.*?)*\}-->/,ivar:/\#\{(@[a-zA-Z0-9_\.\#>=\[\]]+|[a-zA-Z][a-zA-Z0-9_\.]*)(\|.*?)*\}/,loop:/<!--\{[a-zA-Z][a-zA-Z0-9_\.]* in (@[a-zA-Z0-9_\.\#>=\[\]]+|[a-zA-Z][a-zA-Z0-9_\.]*)\}-->/};if(a.match(b.pend)){this.ignore=!1;return this.parent}if(a.match(b.more)){this.ignore=!0;return this}return this.ignore?this:a.match(b.pvar)?this._add("child",new YinYang.TemplateVar(this.template,this,a.replace(/<!--{|}-->/g,""),!0)):a.match(b.ivar)?this._add("self",new YinYang.TemplateVar(this.template,this,a.replace(/\#\{|\}/g,""))):a.match(b.loop)?this._add("child",new YinYang.TemplateLoop(this.template,this,a.replace(/<!--{|}-->/g,""))):this._add("self",new YinYang.TemplateText(this.template,this,a))};a.prototype._add=function(a,b){this.children.push(b);switch(a){case"child":return b;case"self":return this}};a.prototype.display=function(a){var b;a==null&&(a={});return function(){var c,d,e,f;e=this.children;f=[];for(c=0,d=e.length;c<d;c++){b=e[c];f.push(b.display(a))}return f}.call(this).join("")};return a}();YinYang.TemplateLoop=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}__extends(b,a);b.prototype.display=function(a){var b,c,d;this.placeholder_id=YinYang.guid();d=this.value.split(/\s+in\s+/),c=d[0],b=d[1];if(this.template.valueExists(b))return this.displayLoop(a,c,b);if(b.match(/^(ajax|hsql)\./))return this.diaplayPlaceholder(a,c,b);typeof console!="undefined"&&console!==null&&console.log("Template value not found.");return""};b.prototype.displayLoop=function(a,b,c){var d,e,f,g,h;return function(){var i,j,k,l;k=this.template.getValue(c);l=[];for(i=0,j=k.length;i<j;i++){e=k[i];l.push(function(){var c,i,j,k;j=this.children;k=[];for(c=0,i=j.length;c<i;c++){d=j[c];g={};for(f in a){h=a[f];g[f]=h}g[b]=e;k.push(d.display(g))}return k}.call(this).join(""))}return l}.call(this).join("")};b.prototype.diaplayPlaceholder=function(a,b,c){var d=this;this.template.addPlaceholder(this.placeholder_id,c,function(){var e;e=d.displayLoop(a,b,c);return $("#"+d.placeholder_id).before(e).remove()});return'<span class="loading" id="'+this.placeholder_id+'"></span>'};return b}(YinYang.TemplateRoot);YinYang.TemplateVar=function(a){function b(a,b,c,d){var e,f;this.template=a;this.parent=b!=null?b:null;this.value=c!=null?c:"";this.ignore=d!=null?d:!1;f=this.value.split("|");this.value=f.shift();this.filters=function(){var a,b,c;c=[];for(a=0,b=f.length;a<b;a++){e=f[a];c.push(YinYang.createFilter(e))}return c}();this.children=[]}__extends(b,a);b.prototype.display=function(a){var b,c,d,e,f;this.localValues=a;c=this.value.substring(0,1)==="@"?this.displayDom():this.displayVar();f=this.filters;for(d=0,e=f.length;d<e;d++){b=f[d];c=b._process(c)}return c};b.prototype.displayDom=function(){return $(this.value.substring(1)).html()};b.prototype.displayVar=function(){return this.getLocalValue(this.value)||this.template.getValue(this.value)};b.prototype.getLocalValue=function(a){var b,c,d,e;c=a.split(".");d=this.localValues;while(b=c.shift())d=(e=d[b])!=null?e:"";return d};return b}(YinYang.TemplateRoot);YinYang.TemplateText=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}__extends(b,a);b.prototype.display=function(){return this.value};return b}(YinYang.TemplateRoot);YinYang.plugins.ajax=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}__extends(b,a);b.prototype.process=function(){var a=this;return $.getJSON(this.arg).success(function(b){return a.setValue(b)}).error(function(){return typeof console!="undefined"&&console!==null?console.log("ajax error"):void 0})};return b}(YinYang.plugin);YinYang.plugins.hsql=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}__extends(b,a);b.prototype.process=function(){var a=this;return $.getJSON("/hsql.php?q="+b).success(function(b){return a.setValue(b)}).error(function(){return typeof console!="undefined"&&console!==null?console.log("hsql error"):void 0})};return b}(YinYang.plugin);YinYang.filters["default"]=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}__extends(b,a);b.prototype.process=function(a,b){b==null&&(b="");return a||b};return b}(YinYang.filter);YinYang.filters.nl2br=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}__extends(b,a);b.prototype.process=function(a){return a.replace(/\r\n|\n|\r/gim,"<br />")};return b}(YinYang.filter);YinYang.filters.truncate=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}__extends(b,a);b.prototype.process=function(a,b,c){b==null&&(b=80);c==null&&(c="...");return a.length>b?a.substring(0,b-c.length)+c:a};return b}(YinYang.filter);YinYang.filters.beforetag=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}__extends(b,a);b.prototype.process=function(a,b){b==null&&(b="hr");return a.split(new RegExp("(<"+b+".*?>)","im"))[0]};return b}(YinYang.filter);YinYang.filters.aftertag=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}__extends(b,a);b.prototype.process=function(a,b){b==null&&(b="hr");return a.split(new RegExp("(<"+b+".*?>)","im"))[2]};return b}(YinYang.filter);if(!cbSplit){cbSplit=function(a,b,c){var d,e,f,g,h,i,j;if(Object.prototype.toString.call(b)!=="[object RegExp]")return cbSplit._nativeSplit.call(a,b,c);i=[];f=0;d=(b.ignoreCase?"i":"")+(b.multiline?"m":"")+(b.sticky?"y":"");b=RegExp(b.source,d+"g");a+="";cbSplit._compliantExecNpcg||(j=RegExp("^"+b.source+"$(?!\\s)",d));if(c==null||+c<0)c=Infinity;else{c=Math.floor(+c);if(!c)return[]}while(h=b.exec(a)){e=h.index+h[0].length;if(e>f){i.push(a.slice(f,h.index));!cbSplit._compliantExecNpcg&&h.length>1&&h[0].replace(j,function(){var a,b,c,d;d=[];for(a=b=1,c=arguments.length-2;1<=c?b<=c:b>=c;a=1<=c?++b:--b)arguments[a]==null&&d.push(h[a]=void 0);return d});h.length>1&&h.index<a.length&&Array.prototype.push.apply(i,h.slice(1));g=h[0].length;f=e;if(i.length>=c)break}b.lastIndex===h.index&&b.lastIndex++}f===a.length?(g||!b.test(""))&&i.push(""):i.push(a.slice(f));return i.length>c?i.slice(0,c):i};cbSplit._compliantExecNpcg=/()??/.exec("")[1]!=null;cbSplit._nativeSplit=String.prototype.split}String.prototype.split=function(a,b){return cbSplit(this,a,b)};